# RFC-005: Interface de Linguagem Natural

**Status:** Rascunho  
**Autor:** Sistema de Desenvolvimento  
**Data:** Janeiro 2025  
**Vers√£o:** 1.0  

## Resumo

Esta RFC define a interface de linguagem natural que transforma as respostas t√©cnicas da API Hotmart em comunica√ß√£o flu√≠da e compreens√≠vel, adaptada ao contexto e prefer√™ncias do usu√°rio brasileiro.

## Motiva√ß√£o

Os infoprodutores precisam de respostas em linguagem natural que:

- **Sejam Compreens√≠veis:** Evitar jarg√£o t√©cnico, usar termos do dia a dia
- **Sejam Contextuais:** Adaptar tom e detalhes √† situa√ß√£o
- **Sejam Acion√°veis:** Incluir pr√≥ximos passos e recomenda√ß√µes
- **Sejam Culturalmente Apropriadas:** Usar formata√ß√£o e linguagem brasileira

## Especifica√ß√£o T√©cnica

### 1. Sistema de Formata√ß√£o Contextual

```typescript
interface ResponseFormatter {
  formatResponse(
    data: any[], 
    context: FormattingContext, 
    preferences: UserPreferences
  ): FormattedResponse;
}

interface FormattingContext {
  originalCommand: string;
  userIntent: 'consulta' | 'an√°lise' | 'a√ß√£o' | 'relat√≥rio';
  verbosity: 'concisa' | 'normal' | 'detalhada';
  audience: 'iniciante' | 'intermedi√°rio' | 'avan√ßado';
  urgency: 'baixa' | 'normal' | 'alta';
}

interface FormattedResponse {
  summary: string; // Resumo em uma frase
  details: string; // Informa√ß√µes detalhadas
  insights: string[]; // Observa√ß√µes importantes
  actions: ActionSuggestion[]; // Pr√≥ximos passos sugeridos
  rawData?: any; // Dados originais se solicitado
}

interface ActionSuggestion {
  action: string;
  description: string;
  command?: string; // Comando sugerido para executar a a√ß√£o
  priority: 'alta' | 'm√©dia' | 'baixa';
}
```

### 2. Templates de Resposta por Contexto

```typescript
const RESPONSE_TEMPLATES = {
  vendas: {
    resumo_positivo: "Excelente! Voc√™ teve {total_vendas} vendas totalizando {receita_total} em {periodo}.",
    resumo_neutro: "Voc√™ teve {total_vendas} vendas totalizando {receita_total} em {periodo}.",
    resumo_preocupante: "Aten√ß√£o: apenas {total_vendas} vendas ({receita_total}) em {periodo}. Vamos analisar o que pode ser melhorado.",
    
    detalhes: `
üìä **Resumo de Vendas - {periodo}**

üí∞ **Financeiro:**
- Receita total: {receita_total}
- Ticket m√©dio: {ticket_medio}
- Melhor dia: {melhor_dia} ({vendas_melhor_dia} vendas)

üìà **Performance:**
- Total de vendas: {total_vendas}
- Produtos mais vendidos: {top_produtos}
- Taxa de convers√£o: {taxa_conversao}

{insights_adicionais}
    `,
    
    insights: [
      "Seu ticket m√©dio est√° {comparacao_ticket_medio} em rela√ß√£o ao m√™s anterior",
      "O produto '{produto_destaque}' representa {percentual}% das suas vendas",
      "Vendas de final de semana s√£o {tendencia_weekend}% {dire√ß√£o} que dias √∫teis"
    ]
  },
  
  assinaturas: {
    resumo_saudavel: "Suas assinaturas est√£o saud√°veis: {assinaturas_ativas} ativas gerando {receita_recorrente}/m√™s.",
    resumo_atencao: "Aten√ß√£o: {assinaturas_problema} assinaturas precisam de cuidado ({taxa_churn}% de churn).",
    
    detalhes: `
üîÑ **Status das Assinaturas**

‚úÖ **Ativas:** {assinaturas_ativas}
   - Receita recorrente: {receita_recorrente}/m√™s
   - Pr√≥ximas renova√ß√µes: {proximas_renovacoes}

‚ö†Ô∏è  **Requerem Aten√ß√£o:** {assinaturas_problema}
   - Em atraso: {em_atraso}
   - Cancelamento solicitado: {cancelamento_pendente}
   - Problemas de pagamento: {problemas_pagamento}

üìä **M√©tricas:**
   - Taxa de reten√ß√£o: {taxa_retencao}%
   - Vida √∫til m√©dia: {lifetime_value_medio} meses
   - Churn rate: {taxa_churn}%
    `,
    
    actions: [
      {
        action: "Contatar assinaturas em atraso",
        description: "Envie lembretes personalizados para recuperar assinaturas",
        command: "enviar lembretes para assinaturas em atraso",
        priority: "alta"
      },
      {
        action: "Analisar motivos de cancelamento", 
        description: "Identifique padr√µes para reduzir churn",
        command: "analisar cancelamentos do √∫ltimo m√™s",
        priority: "m√©dia"
      }
    ]
  }
};
```

### 3. Sistema de Adapta√ß√£o de Tom

```typescript
class ToneAdapter {
  adaptTone(content: string, context: FormattingContext): string {
    switch (context.audience) {
      case 'iniciante':
        return this.simplifyLanguage(content);
      case 'avan√ßado':
        return this.addTechnicalDetails(content);
      default:
        return content;
    }
  }
  
  private simplifyLanguage(content: string): string {
    const simplifications = {
      'taxa de convers√£o': 'quantos visitantes viram compradores',
      'churn rate': 'taxa de cancelamento',
      'lifetime value': 'valor total que cada cliente gera',
      'ticket m√©dio': 'valor m√©dio de cada venda',
      'receita recorrente': 'dinheiro que entra todo m√™s'
    };
    
    let simplified = content;
    for (const [technical, simple] of Object.entries(simplifications)) {
      simplified = simplified.replace(new RegExp(technical, 'gi'), simple);
    }
    
    return simplified;
  }
  
  private addTechnicalDetails(content: string): string {
    // Adicionar m√©tricas mais detalhadas, f√≥rmulas, etc.
    return content;
  }
}
```

### 4. Formata√ß√£o Cultural Brasileira

```typescript
class BrazilianFormatter {
  formatCurrency(value: number): string {
    return new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(value);
  }
  
  formatDate(date: Date | string): string {
    const dateObj = typeof date === 'string' ? new Date(date) : date;
    return new Intl.DateTimeFormat('pt-BR', {
      day: '2-digit',
      month: '2-digit', 
      year: 'numeric'
    }).format(dateObj);
  }
  
  formatPercentage(value: number): string {
    return new Intl.NumberFormat('pt-BR', {
      style: 'percent',
      minimumFractionDigits: 1,
      maximumFractionDigits: 1
    }).format(value / 100);
  }
  
  formatRelativeTime(pastDate: Date): string {
    const now = new Date();
    const diffMs = now.getTime() - pastDate.getTime();
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'hoje';
    if (diffDays === 1) return 'ontem';
    if (diffDays < 7) return `h√° ${diffDays} dias`;
    if (diffDays < 30) return `h√° ${Math.floor(diffDays / 7)} semanas`;
    if (diffDays < 365) return `h√° ${Math.floor(diffDays / 30)} meses`;
    return `h√° ${Math.floor(diffDays / 365)} anos`;
  }
  
  formatTrend(current: number, previous: number): string {
    const change = ((current - previous) / previous) * 100;
    const absChange = Math.abs(change);
    
    if (absChange < 5) return 'praticamente igual';
    
    const direction = change > 0 ? 'aumentou' : 'diminuiu';
    const magnitude = absChange > 50 ? 'drasticamente' : 
                     absChange > 20 ? 'significativamente' : 
                     'moderadamente';
    
    return `${direction} ${magnitude} (${this.formatPercentage(absChange)})`;
  }
}
```

### 5. Sistema de Insights Autom√°ticos

```typescript
class InsightGenerator {
  generateInsights(data: any[], context: FormattingContext): string[] {
    const insights: string[] = [];
    
    // Insights baseados em padr√µes nos dados
    insights.push(...this.analyzePatterns(data));
    
    // Insights baseados em compara√ß√µes temporais
    insights.push(...this.analyzeTemporalTrends(data));
    
    // Insights baseados em benchmarks
    insights.push(...this.analyzeBenchmarks(data));
    
    // Limitiar n√∫mero de insights baseado na verbosidade
    const maxInsights = context.verbosity === 'concisa' ? 2 : 
                       context.verbosity === 'normal' ? 4 : 6;
    
    return insights.slice(0, maxInsights);
  }
  
  private analyzePatterns(data: any[]): string[] {
    const patterns = [];
    
    // Padr√£o de concentra√ß√£o de vendas
    if (this.isRevenueConcentrated(data)) {
      patterns.push("80% da sua receita vem de apenas 20% dos produtos - considere focar nos mais rent√°veis");
    }
    
    // Padr√£o sazonal
    const seasonality = this.detectSeasonality(data);
    if (seasonality) {
      patterns.push(`Suas vendas s√£o ${seasonality.strength} maiores em ${seasonality.period}`);
    }
    
    // Padr√£o de crescimento
    const growth = this.detectGrowthPattern(data);
    if (growth.trend === 'accelerating') {
      patterns.push("Suas vendas est√£o crescendo de forma acelerada - momento ideal para investir em marketing");
    }
    
    return patterns;
  }
  
  private analyzeTemporalTrends(data: any[]): string[] {
    const trends = [];
    
    const weekdayVsWeekend = this.compareWeekdayVsWeekend(data);
    if (weekdayVsWeekend.significant) {
      trends.push(`Vendas s√£o ${weekdayVsWeekend.percentage}% maiores em ${weekdayVsWeekend.better}`);
    }
    
    return trends;
  }
}
```

### 6. Sugest√µes de A√ß√µes Inteligentes

```typescript
class ActionSuggestionEngine {
  generateSuggestions(data: any[], context: FormattingContext): ActionSuggestion[] {
    const suggestions: ActionSuggestion[] = [];
    
    // Sugest√µes baseadas em problemas identificados
    suggestions.push(...this.suggestionsForProblems(data));
    
    // Sugest√µes baseadas em oportunidades
    suggestions.push(...this.suggestionsForOpportunities(data));
    
    // Sugest√µes baseadas no contexto temporal
    suggestions.push(...this.suggestionsForTiming(data, context));
    
    return suggestions.sort((a, b) => {
      const priorityOrder = { 'alta': 3, 'm√©dia': 2, 'baixa': 1 };
      return priorityOrder[b.priority] - priorityOrder[a.priority];
    });
  }
  
  private suggestionsForProblems(data: any[]): ActionSuggestion[] {
    const suggestions = [];
    
    // Baixo volume de vendas
    if (this.isLowSalesVolume(data)) {
      suggestions.push({
        action: "Revisar estrat√©gia de marketing",
        description: "Volume de vendas abaixo do esperado. Considere campanhas promocionais ou revis√£o de pre√ßos.",
        command: "analisar performance de marketing",
        priority: "alta"
      });
    }
    
    // Alto churn em assinaturas
    if (this.isHighChurn(data)) {
      suggestions.push({
        action: "Implementar programa de reten√ß√£o",
        description: "Taxa de cancelamento alta. Crie estrat√©gias para manter assinantes.",
        command: "criar campanha de reten√ß√£o",
        priority: "alta"
      });
    }
    
    return suggestions;
  }
  
  private suggestionsForOpportunities(data: any[]): ActionSuggestion[] {
    const suggestions = [];
    
    // Produto com alta demanda
    const hotProducts = this.identifyHotProducts(data);
    if (hotProducts.length > 0) {
      suggestions.push({
        action: "Criar upsell para produtos em alta",
        description: `${hotProducts[0].name} est√° vendendo muito bem. Considere criar produtos complementares.`,
        command: `analisar oportunidades de upsell para ${hotProducts[0].id}`,
        priority: "m√©dia"
      });
    }
    
    return suggestions;
  }
}
```

### 7. Personaliza√ß√£o por Perfil de Usu√°rio

```typescript
interface UserProfile {
  businessType: 'curso_online' | 'ebook' | 'software' | 'consultoria' | 'assinatura';
  experience: 'iniciante' | 'intermedi√°rio' | 'avan√ßado';
  mainGoals: ('aumentar_vendas' | 'reduzir_churn' | 'otimizar_conversao' | 'expandir_mercado')[];
  communicationStyle: 'direto' | 'detalhado' | 'visual';
}

class PersonalizedResponseGenerator {
  generateResponse(
    data: any[], 
    profile: UserProfile,
    context: FormattingContext
  ): FormattedResponse {
    
    // Adaptar linguagem ao tipo de neg√≥cio
    const terminology = this.getBusinessTerminology(profile.businessType);
    
    // Focar nas m√©tricas mais relevantes
    const relevantMetrics = this.getRelevantMetrics(profile.businessType, profile.mainGoals);
    
    // Ajustar n√≠vel de detalhamento
    const detailLevel = this.determineDetailLevel(profile.experience, context.verbosity);
    
    return this.buildResponse(data, terminology, relevantMetrics, detailLevel);
  }
  
  private getBusinessTerminology(businessType: string): Record<string, string> {
    const terminologies = {
      'curso_online': {
        'customer': 'aluno',
        'purchase': 'matr√≠cula',
        'revenue': 'receita de cursos'
      },
      'ebook': {
        'customer': 'leitor',
        'purchase': 'venda',
        'revenue': 'receita de vendas'
      },
      'assinatura': {
        'customer': 'assinante',
        'purchase': 'assinatura',
        'revenue': 'receita recorrente'
      }
    };
    
    return terminologies[businessType] || {};
  }
}
```

## Exemplos de Sa√≠da Formatada

### 1. Consulta Simples - Vendas
**Input:** "vendas do √∫ltimo m√™s"
**Output:**
```
üí∞ **Resumo de Vendas - Dezembro 2024**

Excelente! Voc√™ teve 127 vendas totalizando R$ 45.890,00 em dezembro.

üìä **Destaques:**
‚Ä¢ Ticket m√©dio: R$ 361,34 (+12% vs novembro)
‚Ä¢ Melhor dia: 15/12 (18 vendas - Black Friday!)
‚Ä¢ Produto campe√£o: "Curso de Marketing Digital" (R$ 18.450,00)

üí° **Insights:**
‚Ä¢ Suas vendas de final de semana s√£o 34% maiores que dias √∫teis
‚Ä¢ Dezembro foi seu melhor m√™s do ano (+67% vs m√©dia anual)
‚Ä¢ Taxa de convers√£o est√° excelente: 4,2%

üéØ **Pr√≥ximos Passos:**
1. **Aproveitar o momentum** - Lance uma campanha de Janeiro para manter o ritmo
2. **Expandir o produto campe√£o** - Crie um curso avan√ßado ou m√≥dulos extras
```

### 2. An√°lise Complexa - Assinaturas
**Input:** "assinaturas com problema"
**Output:**
```
‚ö†Ô∏è **An√°lise de Assinaturas - Situa√ß√£o Requer Aten√ß√£o**

Identificamos 23 assinaturas que precisam de cuidado (taxa de churn: 8,5%).

üîç **Detalhamento:**
‚Ä¢ **Em atraso:** 12 assinaturas (R$ 2.890,00 em risco)
‚Ä¢ **Cancelamento solicitado:** 8 assinaturas 
‚Ä¢ **Problemas de pagamento:** 3 assinaturas

üìà **Impacto Financeiro:**
‚Ä¢ Receita em risco: R$ 4.234,00/m√™s
‚Ä¢ Recupera√ß√£o potencial: R$ 2.890,00 (68%)

üéØ **A√ß√µes Recomendadas (por ordem de prioridade):**

**üö® URGENTE - Hoje:**
1. **Contatar assinaturas em atraso** ‚Üí Use: "enviar lembretes personalizados"
2. **Atualizar dados de pagamento** ‚Üí Use: "verificar cart√µes vencidos"

**üìã Esta Semana:**
3. **Pesquisa de cancelamento** ‚Üí Use: "criar pesquisa de motivo de cancelamento"
4. **Oferta de reten√ß√£o** ‚Üí Use: "criar oferta especial para reten√ß√£o"

üí° **Dica:** Clientes em atraso h√° menos de 7 dias t√™m 85% de chance de reativa√ß√£o!
```

## Arquivos Impactados

- `nodes/Hotmart/v1/formatting/` - Novo diret√≥rio
  - `ResponseFormatter.ts`
  - `ToneAdapter.ts`
  - `BrazilianFormatter.ts`
  - `InsightGenerator.ts`
  - `ActionSuggestionEngine.ts`
  - `PersonalizedResponseGenerator.ts`
  - `responseTemplates.ts`
- `nodes/Hotmart/v1/HotmartV1.node.ts` - Integra√ß√£o com formata√ß√£o

## Compatibilidade

- ‚úÖ **Portugu√™s Brasileiro:** Formata√ß√£o cultural nativa
- ‚úÖ **M√∫ltiplos Perfis:** Adapta√ß√£o autom√°tica ao usu√°rio
- ‚úÖ **Escalabilidade:** Templates extens√≠veis

## Crit√©rios de Aceita√ß√£o

- [ ] Respostas em portugu√™s brasileiro fluente e natural
- [ ] Formata√ß√£o cultural correta (moeda, datas, n√∫meros)
- [ ] Adapta√ß√£o de tom baseada no perfil do usu√°rio
- [ ] Insights autom√°ticos relevantes e acion√°veis
- [ ] Sugest√µes de a√ß√µes priorizadas por impacto
- [ ] Templates para todos os tipos de opera√ß√£o da Hotmart

## Depend√™ncias

- RFC-001 (Estrutura Base MCP)
- RFC-002 (Sistema de Processamento de Linguagem Natural)
- RFC-003 (Mapeamento Inteligente de Opera√ß√µes)
- RFC-004 (Sistema de Contexto e Mem√≥ria)

## Pr√≥ximos Passos

Ap√≥s implementa√ß√£o desta RFC:
1. RFC-006: Sistema de Monitoramento e Analytics
2. RFC-007: Testes e Valida√ß√£o

## Testes

### Casos de Teste de Formata√ß√£o

```typescript
describe('Interface de Linguagem Natural', () => {
  test('deve formatar vendas com insights', () => {
    const formatter = new ResponseFormatter();
    const salesData = [/* dados de venda */];
    
    const response = formatter.formatResponse(salesData, {
      originalCommand: 'vendas do √∫ltimo m√™s',
      userIntent: 'consulta',
      verbosity: 'normal'
    });
    
    expect(response.summary).toContain('vendas');
    expect(response.insights).toHaveLength(3);
    expect(response.actions).toHaveLength(2);
  });
  
  test('deve adaptar tom para usu√°rio iniciante', () => {
    const adapter = new ToneAdapter();
    const technical = "Taxa de convers√£o de 4,2% com churn rate baixo";
    const simplified = adapter.adaptTone(technical, { audience: 'iniciante' });
    
    expect(simplified).not.toContain('churn rate');
    expect(simplified).toContain('taxa de cancelamento');
  });
});
```

## M√©tricas de Qualidade

- **Compreensibilidade:** > 95% das respostas s√£o compreendidas pelos usu√°rios
- **Relev√¢ncia dos Insights:** > 80% dos insights s√£o considerados √∫teis
- **Taxa de A√ß√£o:** > 60% das sugest√µes s√£o seguidas pelos usu√°rios
- **Satisfa√ß√£o:** > 90% de avalia√ß√£o positiva da linguagem natural